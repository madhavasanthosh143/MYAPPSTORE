<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Products</title>
  <style>
    .product {
      border: 1px solid #ccc;
      padding: 15px;
      margin: 10px;
      width: 250px;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body style="font-family: Arial;">
  <h2>üõí Grocery Store </h2>
  <div id="product-container" style="display: flex; flex-wrap: wrap;"></div>

  <script>
    // Fetch all products from backend
    fetch('http://localhost:9019/api/products')  // Adjust API URL if needed
      .then(response => response.json())
      .then(products => {
        const container = document.getElementById('product-container');

        products.forEach(product => {
          const div = document.createElement('div');
          div.className = 'product';

          div.innerHTML = `
            <h3>${product.name}</h3>
            <p>Price: ‚Çπ${product.price}</p>
            <label>Quantity: 
              <input type="number" id="qty-${product.id}" value="1" min="1" onchange="updateTotal(${product.id}, ${product.price})">
            </label>
            <p>Total: ‚Çπ<span id="total-${product.id}">${product.price}</span></p>
            <button onclick="addToCart(${product.id}, ${product.price})">Add to Cart</button>
          `;

          container.appendChild(div);
        });
      })
      .catch(error => {
        alert("‚ùå Failed to load products: " + error);
      });

    // Update total price dynamically
    function updateTotal(id, price) {
      const qty = parseInt(document.getElementById("qty-" + id).value);
      document.getElementById("total-" + id).innerText = price * qty;
    }

    // Send productId and quantity to backend
    function addToCart(productId, price) {
      const qty = parseInt(document.getElementById("qty-" + productId).value);
      if (qty <= 0) {
        alert("‚ùó Enter valid quantity");
        return;
      }

      const formData = new URLSearchParams();
      formData.append("productId", productId);
      formData.append("quantity", qty);

      fetch('http://localhost:8080/cart/cart/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: formData
      }).then(res => {
        if (res.ok) {
          alert("‚úÖ Product added to cart!");
        } else {
          alert("‚ùå Failed to add product.");
        }
      });
    }
  </script>
</body>
</html>
