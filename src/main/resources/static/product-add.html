<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grocery Products</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, purple, red);
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      margin-top: 30px;
      color: #333;
    }

    .ad-banner {
      background-color: #ffcc00;
      color: #333;
      padding: 10px 0;
      font-weight: bold;
      font-size: 18px;
    }
	.search-container select {
	  padding: 10px;
	  font-size: 16px;
	  border: 1px solid #ccc;
	  border-radius: 4px;
	  background-color: white;
	  cursor: pointer;
	  transition: background-color 0.3s ease;
	}

	.search-container select:hover {
	  background-color: #f1f1f1;
	}

	.search-container select:focus {
	  outline: none;
	  border-color: #ff6600;
	  box-shadow: 0 0 5px rgba(255, 102, 0, 0.5);
	}

    .search-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      gap: 10px;
    }

    .search-container input {
      padding: 10px;
      width: 400px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .search-container button,
    .search-container a {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #ff6600;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
    }

    .search-container button:hover,
    .search-container a:hover {
      background-color: #e65c00;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding: 20px 40px;
    }

    .product-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
    }

    .product-card img {
      max-width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 5px;
    }

    .product-card h3 {
      margin: 10px 0 5px;
      font-size: 18px;
    }

    .product-card p {
      font-size: 14px;
      color: #666;
    }

    .price {
      margin: 10px 0;
      color: #e91e63;
      font-weight: bold;
    }

    .product-card button {
      padding: 8px 16px;
      background-color: #ff6600;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .product-card button:hover {
      background-color: #e65c00;
    }

    .category-bar {
      display: flex;
      justify-content: center;
      gap: 40px;
      padding: 20px;
      background-color: #f8f8f8;
    }

    .category-item {
      position: relative;
      text-align: center;
    }

    .category-item img {
      width: 60px;
      height: 60px;
      cursor: pointer;
    }

    .options-dropdown {
      display: none;
      flex-direction: column;
      position: absolute;
      top: 70px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      border-radius: 6px;
      padding: 10px;
      z-index: 10;
    }

    .category-item:hover .options-dropdown {
      display: flex;
    }

    .options-dropdown button {
      margin: 4px 0;
      padding: 6px 12px;
      border: none;
      background-color: #eee;
      border-radius: 4px;
      cursor: pointer;
    }

    .options-dropdown button:hover {
      background-color: #ddd;
    }
	
	.logout-container {
	  position: absolute;
	  top: 10px;
	  right: 20px;
	}

	.logout-button {
	  background-color: #FFD700;
	  color: black;
	  border: none;
	  padding: 10px 18px;
	  font-size: 14px;
	  border-radius: 6px;
	  cursor: pointer;
	  transition: background-color 0.3s ease;
	}

	.logout-button:hover {
	  background-color: #c9302c;
	}

  </style>
</head>
<body>
  <h1>Grocery Products</h1>
  <marquee behavior="scroll" direction="left" class="ad-banner">
    üõí Big Sale on Groceries! Get 50% OFF on selected items! ¬†¬†¬†
    üöö Free Delivery on orders above ‚Çπ499! ¬†¬†¬†
    üéÅ Buy 1 Get 1 Free on snacks and beverages!
  </marquee>

  <div style="text-align: center; margin: 20px;">
    <a href="cart.html">üõí Go to Cart</a>
	<div class="logout-container">
	    <button class="logout-button" onclick="logoutUser()">üö™ Logout</button>
	  </div>
  </div>

  <h2 style="text-align: center;">Search Products</h2>
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Enter product name">
    <button onclick="searchProduct()">Search</button>
	<select id="priceRange" onchange="filterByPriceRange()">
	  <option value="">üîç Filter by Price</option>
	  <option value="0-1000">‚Çπ0 - ‚Çπ1,000</option>
	  <option value="1000-2000">‚Çπ1,000 - ‚Çπ2,000</option>
	  <option value="2000-5000">‚Çπ2,000 - ‚Çπ5,000</option>
	  <option value="5000-100000">‚Çπ5,000 - ‚Çπ1,00,000</option>
	</select>

    <a href="view-products.html">üëÅÔ∏è View Products</a>
	<button onclick="loadProducts()">üîÑ Refresh Products</button>

  </div>

  <div class="category-bar">
    <div class="category-item">
      <img src="icons/fruits.png" alt="Fruits">
      <div class="options-dropdown">
        <button>Apple</button>
        <button>Banana</button>
        <button>Orange</button>
      </div>
    </div>
    <div class="category-item">
      <img src="icons/vegetables.png" alt="Vegetables">
      <div class="options-dropdown">
        <button>Potato</button>
        <button>Carrot</button>
        <button>Tomato</button>
      </div>
    </div>
  </div>

  <div id="productGrid" class="product-grid"></div>

  <script>
	function addToCart(productId) {
	  const qtyInput = document.getElementById(`qty-${productId}`);
	  const quantity = parseInt(qtyInput.value);

	  if (isNaN(quantity) || quantity <= 0) {
	    alert("‚ùó Please enter a valid quantity");
	    return;
	  }

	  const formData = new URLSearchParams();
	  formData.append("productId", productId);
	  formData.append("quantity", quantity);

	  fetch('http://localhost:9019/cart/add', {
	    method: 'POST',
	    headers: {
	      'Content-Type': 'application/x-www-form-urlencoded'
	    },
	    body: formData
	  })
	    .then(res => {
	      if (res.ok) {
	        alert("‚úÖ Product added to cart!");
	        window.location.href = "cart.html";
	      } else {
	        alert("‚ùå Failed to add product.");
	      }
	    })
	    .catch(err => {
	      console.error("Error:", err);
	      alert("‚ùå Something went wrong");
	    });
	}


    async function loadProducts() {
      try {
        const response = await fetch('http://localhost:9019/products');
        if (!response.ok) throw new Error("Failed to fetch");

        const products = await response.json();
        displayProducts(products);
      } catch (err) {
        console.error('Error:', err);
        document.getElementById('productGrid').innerHTML = '<p style="color:red">Failed to load products.</p>';
      }
    }

    function displayProducts(products) {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';

      if (products.length === 0) {
        grid.innerHTML = '<p>No products found</p>';
        return;
      }

      products.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <img src="${product.imageUrl}" alt="${product.name}">
          <h3>${product.name}</h3>
          <p>${product.description}</p>
          <div class="price">‚Çπ${product.price}</div>
          <input type="number" id="qty-${product.id}" value="1" min="1" style="width: 60px; margin: 5px auto;">
          <button onclick="addToCart(${product.id})">Add to Cart</button>
        `;
        grid.appendChild(card);
      });
    }
	async function filterByPriceRange() {
	  const range = document.getElementById('priceRange').value;

	  if (!range) {
	    loadProducts(); // Reset to all if no range selected
	    return;
	  }

	  const [min, max] = range.split('-');

	  try {
	    const response = await fetch(`http://localhost:9019/products/cheap?min=${min}&max=${max}`);
	    if (!response.ok) throw new Error("Failed to fetch filtered products");

	    const products = await response.json();
	    displayProducts(products); // Show only filtered products
	  } catch (err) {
	    console.error('Price filter error:', err);
	    document.getElementById('productGrid').innerHTML = '<p style="color:red">Could not load filtered products.</p>';
	  }
	}
	
	function logoutUser() {
	      fetch('http://localhost:9019/custom-logout', {
	        method: 'POST',
	        credentials: 'include' // Important for session-based logout
	      })
	      .then(response => {
	        if (response.ok) {
	          alert("‚úÖ Logged out successfully.");
	          window.location.href = "/login.html"; // Ensure this file exists in /static
	        } else {
	          alert("‚ùå Logout failed.");
	        }
	      })
	      .catch(error => {
	        console.error("Logout error:", error);
	        alert("‚ùå Error during logout.");
	      });
	    }


    async function searchProduct() {
      const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
      try {
        const response = await fetch('http://localhost:9019/products');
        const products = await response.json();
        const filtered = products.filter(product =>
          product.name.toLowerCase().includes(searchTerm)
        );
        displayProducts(filtered);
      } catch (error) {
        console.error('Search error:', error);
        document.getElementById('productGrid').innerHTML = '<p style="color:red">Search failed.</p>';
      }
    }
    loadProducts();
  </script>
</body>
</html>
